<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { margin:0; font-family:sans-serif; background:#0b0d14; color:#cfd3dc }
      .wrap { padding:14px }
      h3 { margin:0; padding:12px 14px; border-bottom:1px solid #1f2330 }
      label { display:block; font-size:12px; margin-top:8px }
      input, select { width:100%; box-sizing:border-box; background:#121623; color:#e6e6e6; border:1px solid #2a3040; border-radius:8px; padding:8px 10px; outline:none }
      input:focus, select:focus { border-color:#3a4160; box-shadow:0 0 0 3px rgba(42,48,64,.35) }
      .row { display:flex; gap:8px }
      .row > div { flex:1 }
      button { margin-top:12px; background:#2a5bd7; border:1px solid #2a5bd7; color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer }
      button:hover { background:#2f66ef }
    </style>
  </head>
  <body>
    <h3 id="title">Edit Tunnel</h3>
    <div class="wrap">
      <label>Name</label>
      <input id="name" placeholder="Optional name" />
      <div class="row">
        <div>
          <label>Local host</label>
          <input id="lhost" value="127.0.0.1" />
        </div>
        <div>
          <label>Local port</label>
          <input id="lport" value="8080" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Remote host</label>
          <input id="rhost" value="127.0.0.1" />
        </div>
        <div>
          <label>Remote port</label>
          <input id="rport" value="80" />
        </div>
      </div>
      <button id="save">Save</button>
    </div>
    <script>
      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search)
        return params.get(name)
      }
      try {
        const presetRaw = getQueryParam('preset')
        if (presetRaw) {
          const t = JSON.parse(decodeURIComponent(presetRaw))
          if (t.name) document.getElementById('name').value = t.name
          if (t.localHost) document.getElementById('lhost').value = t.localHost
          if (t.localPort) document.getElementById('lport').value = String(t.localPort)
          if (t.remoteHost) document.getElementById('rhost').value = t.remoteHost
          if (t.remotePort) document.getElementById('rport').value = String(t.remotePort)
        }
      } catch {}

      document.getElementById('save').onclick = async () => {
        const name = (document.getElementById('name').value || '').trim()
        const localHost = (document.getElementById('lhost').value || '127.0.0.1').trim()
        const localPort = Number((document.getElementById('lport').value || '0').trim())
        const remoteHost = (document.getElementById('rhost').value || '127.0.0.1').trim()
        const remotePort = Number((document.getElementById('rport').value || '0').trim())
        if (!localPort || !remotePort) { alert('Ports are required'); return }
        const presetRaw = getQueryParam('preset')
        let base = {}
        try { base = JSON.parse(decodeURIComponent(presetRaw)) || {} } catch {}
        const out = Object.assign({}, base, { name, localHost, localPort, remoteHost, remotePort })
        try { window.api.tunnelFormSubmit(out) } catch {}
      }
    </script>
  </body>
  </html>

